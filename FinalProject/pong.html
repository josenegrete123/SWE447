<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>PONG</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
	<body>
		<script src="../Common/three.js"></script>
		<script src="../Common/THREEx.KeyboardState.js"></script>
		<script>
var WIDTH = 1920,
	HEIGHT = 875;
 
var FOV = 100,
	ASPECT = WIDTH / HEIGHT,
	NEAR = 0.1,
	FAR = 2000;
 
var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(FOV, ASPECT, NEAR, FAR);
var keyboard = new THREEx.KeyboardState();
camera.position.z = 5;
 
var renderer = new THREE.WebGLRenderer();
renderer.setSize(WIDTH, HEIGHT);
document.body.appendChild(renderer.domElement);
 
var geometry = new THREE.BoxGeometry(.5, .25, .5);
var material = new THREE.MeshBasicMaterial({ color: 0xbe2626});
var geometry2 = new THREE.BoxGeometry(.5, 1.75, .5);
var material2 = new THREE.MeshBasicMaterial({ color: 0x2f9acf });
            var geometry3 = new THREE.BoxGeometry(25, 1, 1);
            var material3 = new THREE.MeshBasicMaterial({ color: 0x932f7b }); 
            var geometry4 = new THREE.BoxGeometry(.2, 10.10, .2);
            var material4 = new THREE.MeshBasicMaterial({ color: 0xcacccd }); 
var player1 = new THREE.Mesh(geometry2, material);
var player1_1 = new THREE.Mesh(geometry, material);
var player1_2 = new THREE.Mesh(geometry, material);
var player1_3 = new THREE.Mesh(geometry, material);
var player1_4 = new THREE.Mesh(geometry, material);
var player1_5 = new THREE.Mesh(geometry, material);
var player1_6 = new THREE.Mesh(geometry, material);
var player1_7 = new THREE.Mesh(geometry, material);
var player2 = new THREE.Mesh(geometry2, material2);
var player2_1 = new THREE.Mesh(geometry, material2);
var player2_2 = new THREE.Mesh(geometry, material2);
var player2_3 = new THREE.Mesh(geometry, material2);
var player2_4 = new THREE.Mesh(geometry, material2);
var player2_5 = new THREE.Mesh(geometry, material2);
var player2_6 = new THREE.Mesh(geometry, material2);
var player2_7 = new THREE.Mesh(geometry, material2);
var topBarrier = new THREE.Mesh(geometry3, material3);
var bottomBarrier = new THREE.Mesh(geometry3, material3);
            var leftGoal = new THREE.Mesh(geometry4, material4);
            var rightGoal = new THREE.Mesh(geometry4, material4);
scene.add(player1);
scene.add(player1_1);
scene.add(player1_2);
scene.add(player1_3);
scene.add(player1_4);
scene.add(player1_5);
scene.add(player1_6);
scene.add(player1_7);
scene.add(player2);
scene.add(player2_1);
scene.add(player2_2);
scene.add(player2_3);
scene.add(player2_4);
scene.add(player2_5);
scene.add(player2_6);
scene.add(player2_7);
            scene.add(topBarrier);
            scene.add(bottomBarrier);
            scene.add(leftGoal);
            scene.add(rightGoal);
var geometryBall = new THREE.SphereGeometry(.2, 7, 7);
var material = new THREE.MeshBasicMaterial({ color: 0xcacccd });
var ball = new THREE.Mesh(geometryBall, material);
scene.add(ball);
            var backgroundMiddle = new THREE.BoxGeometry(.35, 1.5, .5);
            var material22 = new THREE.MeshBasicMaterial({ color: 0x6a6b6b });
            var BGM = new THREE.Mesh(backgroundMiddle, material22);
            scene.add(BGM);
            BGM.position.z = -10;
            BGM.position.y = 2;
            var BGM2 = BGM.clone();
            scene.add(BGM2);
            BGM2.position.y = -2;
            var BGM3 = BGM.clone();
            scene.add(BGM3);
            BGM3.position.y = 6;
            var BGM4 = BGM.clone();
            scene.add(BGM4);
            BGM4.position.y = -6;
            var BGM5 = BGM.clone();
            scene.add(BGM5);
            BGM5.position.y = 10;
            var BGM6 = BGM.clone();
            scene.add(BGM6);
            BGM6.position.y = -10;
            var BGM7 = BGM.clone();
            scene.add(BGM7);
            BGM7.position.y = 14;
            var BGM8 = BGM.clone();
            scene.add(BGM8);
            BGM8.position.y = -14;
			
var text2 = document.createElement('div');
text2.style.position = 'absolute';
//text2.style.zIndex = 1;
text2.style.width = 100;
text2.style.height = 100;
text2.style.color = "white";
text2.style.fontSize = "large";
text2.innerHTML = "Press Space to start!";
text2.style.top = 230 + 'px';
text2.style.left = (WIDTH/2.15) + 'px';
document.body.appendChild(text2);

var text3 = document.createElement('div');
text3.style.position = 'absolute';
text3.style.width = 100;
text3.style.height = 100;
text3.style.color = "white";
text3.style.fontSize = "large";
text3.innerHTML =  "Press B to activate Special Mode!";
text3.style.top = 620 + 'px';
text3.style.left = (WIDTH / 2.25) + 'px';
document.body.appendChild(text3);

var text4 = document.createElement('div');
text4.style.position = 'absolute';
text4.style.textAlign = 'center';
text4.style.width = 100;
text4.style.color = "white";
text4.style.fontSize = "large";
text4.innerHTML = "W <br><br> S";
text4.style.top = (HEIGHT/2.1) + 'px';
text4.style.left = (WIDTH / 5.3) + 'px';
document.body.appendChild(text4);

var text5 = document.createElement('div');
text5.style.position = 'absolute';
text5.style.textAlign = 'center';
text5.style.width = 100;
text5.style.color = "white";
text5.style.fontSize = "large";
text5.innerHTML = "↑<br><br> ↓";
text5.style.top = (HEIGHT/2.1) + 'px';
text5.style.left = (WIDTH / 1.24) + 'px';
document.body.appendChild(text5);

var score = document.createElement('div');
            score.style.position = 'absolute';
//score.style.zIndex = 1;
            score.style.width = 200;
            score.style.height = 200;
            score.style.color = "white";
            score.style.fontSize = "xx-large";
            score.innerHTML = "Score: ";
            score.style.top = 5 + 'px';
            score.style.left = (WIDTH / 2.1) + 'px';
            document.body.appendChild(score);
var P1Score = 0;
var P2Score = 0;
var player1score = document.createElement('div');
player1score.style.position = 'absolute';
//player1score.style.zIndex = 1;
player1score.style.width = 200;
player1score.style.height = 200;
player1score.style.color = "white";
player1score.style.fontSize = "x-large";
player1score.innerHTML = P1Score;
player1score.style.top = 40 + 'px';
player1score.style.left = (WIDTH / 2.1) + 'px';
document.body.appendChild(player1score);
var player2score = document.createElement('div');
player2score.style.position = 'absolute';
//player1score.style.zIndex = 1;
player2score.style.width = 200;
player2score.style.height = 200;
player2score.style.color = "white";
player2score.style.fontSize = "x-large";
player2score.innerHTML = P2Score;
player2score.style.top = 40 + 'px';
player2score.style.left = (WIDTH / 1.95) + 'px';
document.body.appendChild(player2score);
player1.position.x = -10;
player2.position.x = 10;
topBarrier.position.y = 6;
bottomBarrier.position.y = -6;
leftGoal.position.x = -12;
rightGoal.position.x = 12;
            var checkP1 = false;
            var checkP1_1 = false;
            var checkP1_2 = false;
            var checkP1_3 = false;
            var checkP1_4 = false;
            var checkP1_5 = false;
            var checkP1_6 = false;
            var checkP1_7 = false;
            var checkP2 = false;
			var checkTopCol = false;
			var checkBottomCol = false;
            var startGame = false;
            var startedGame = false;
            var p1Lose = false;
            var p2Lose = false;
            var firstStart = true;
            var specialMode = false;
            var ballSpeed = .1;
            var ballDirX = 1
			var ballDirY = 1;
            var difficulty = 1;
            var orginalSpeed = ballSpeed + .05;
            var temp = Math.random();
var animate = function() {
    requestAnimationFrame(animate);
    firstBB = new THREE.Box3().setFromObject(player1);
    secondBB = new THREE.Box3().setFromObject(player2);
    topCol = new THREE.Box3().setFromObject(topBarrier);
    bottomCol = new THREE.Box3().setFromObject(bottomBarrier);
    ballCol = new THREE.Box3().setFromObject(ball);
    lftGoalCol = new THREE.Box3().setFromObject(leftGoal);
    rgtGoalCol = new THREE.Box3().setFromObject(rightGoal);
    
            var topCollisionP1 = firstBB.intersectsBox(topCol);
            var topCollisionP2 = secondBB.intersectsBox(topCol);
            var bottomCollisionP1 = firstBB.intersectsBox(bottomCol);
            var bottomCollisionP2 = secondBB.intersectsBox(bottomCol);
            var ballCollisionP1 = firstBB.intersectsBox(ballCol);
            var ballCollisionP2 = secondBB.intersectsBox(ballCol);
            var topBallCollision = ballCol.intersectsBox(topCol);
            var bottomBallCollision = ballCol.intersectsBox(bottomCol);
            var leftGoalCollision = ballCol.intersectsBox(lftGoalCol);
            var rightGoalCollision = ballCol.intersectsBox(rgtGoalCol);
            player1_1.position.y = player1.position.y + .75;
            player1_2.position.y = player1.position.y + .5;
            player1_3.position.y = player1.position.y + .25;//mid
            player1_4.position.y = player1.position.y ;//mid
            player1_5.position.y = player1.position.y  -.25;//mid
            player1_6.position.y = player1.position.y - .5;
            player1_7.position.y = player1.position.y - .75;
            player1_1.position.x = player1.position.x;
            player1_2.position.x = player1.position.x;
            player1_3.position.x = player1.position.x;
            player1_4.position.x = player1.position.x;
            player1_5.position.x = player1.position.x;
            player1_6.position.x = player1.position.x;
            player1_7.position.x = player1.position.x;
    
            player2_1.position.y = player2.position.y + .75;
            player2_2.position.y = player2.position.y + .5;
            player2_3.position.y = player2.position.y + .25;
            player2_4.position.y = player2.position.y ;
            player2_5.position.y = player2.position.y  -.25;
            player2_6.position.y = player2.position.y - .5;
            player2_7.position.y = player2.position.y - .75;
                                         
            player2_1.position.x = player2.position.x;
            player2_2.position.x = player2.position.x;
            player2_3.position.x = player2.position.x;
            player2_4.position.x = player2.position.x;
            player2_5.position.x = player2.position.x;
            player2_6.position.x = player2.position.x;
            player2_7.position.x = player2.position.x;
                firstBB_1 = new THREE.Box3().setFromObject(player1_1);
                var ballCollisionP1_1 = firstBB_1.intersectsBox(ballCol);
                firstBB_2 = new THREE.Box3().setFromObject(player1_2);
                var ballCollisionP1_2 = firstBB_2.intersectsBox(ballCol);
                firstBB_3 = new THREE.Box3().setFromObject(player1_3);
                var ballCollisionP1_3 = firstBB_3.intersectsBox(ballCol);
                firstBB_4 = new THREE.Box3().setFromObject(player1_4);
                var ballCollisionP1_4 = firstBB_4.intersectsBox(ballCol);
                firstBB_5 = new THREE.Box3().setFromObject(player1_5);
                var ballCollisionP1_5 = firstBB_5.intersectsBox(ballCol);
                firstBB_6 = new THREE.Box3().setFromObject(player1_6);
                var ballCollisionP1_6 = firstBB_6.intersectsBox(ballCol);
                firstBB_7 = new THREE.Box3().setFromObject(player1_7);
                var ballCollisionP1_7 = firstBB_7.intersectsBox(ballCol);
    
                secondBB_1 = new THREE.Box3().setFromObject(player2_1);
                var ballCollisionP2_1 = secondBB_1.intersectsBox(ballCol);
                secondBB_2 = new THREE.Box3().setFromObject(player2_2);
                var ballCollisionP2_2 = secondBB_2.intersectsBox(ballCol);
                secondBB_3 = new THREE.Box3().setFromObject(player2_3);
                var ballCollisionP2_3 = secondBB_3.intersectsBox(ballCol);
                secondBB_4 = new THREE.Box3().setFromObject(player2_4);
                var ballCollisionP2_4 = secondBB_4.intersectsBox(ballCol);
                secondBB_5 = new THREE.Box3().setFromObject(player2_5);
                var ballCollisionP2_5 = secondBB_5.intersectsBox(ballCol);
                secondBB_6 = new THREE.Box3().setFromObject(player2_6);
                var ballCollisionP2_6 = secondBB_6.intersectsBox(ballCol);
                secondBB_7 = new THREE.Box3().setFromObject(player2_7);
                var ballCollisionP2_7 = secondBB_7.intersectsBox(ballCol);
			if(keyboard.pressed("r")){
			//ball.position.x = 0;
			//ball.position.y = 0;
			//ballSpeed = orginalSpeed;
			}
			if(keyboard.pressed("h")){ // add difficulty
				difficulty +=.05;
            }
            if (keyboard.pressed("b")&& startGame == false) { // add special mode
                    specialMode = true;
					text3.style.textAlign = 'center';
					text3.innerHTML = "Special mode activated!<br>Press Z to deactivate Special mode!";
					text3.style.left = (WIDTH / 2.28) + 'px';
					text4.innerHTML = "W <br>A  D<br> S";
					text5.innerHTML = "↑<br>←  →<br> ↓"
            }
			
			if(keyboard.pressed("z") && startGame == false){
						specialMode = false;
						text3.style.textAlign = 'center';
						text3.innerHTML =  "Press B to activate Special Mode!";
						text3.style.left = (WIDTH / 2.25) + 'px';
						text4.innerHTML = "W <br><br> S";
						text5.innerHTML = "↑<br><br> ↓"
			}
            if (keyboard.pressed("w")) {
                player1.position.y += 0.2 * difficulty;
            }
            if (keyboard.pressed("s")) {
                player1.position.y -= 0.2* difficulty;
            }
            if (keyboard.pressed('down')) {
                player2.position.y -= 0.2 * difficulty;
            }
            if (keyboard.pressed('up')) {
                player2.position.y += 0.2 * difficulty;
            }
            if (specialMode == true && startedGame == true) {
                
                if (keyboard.pressed("d")) {
                    player1.position.x += 0.2* difficulty;
                }
            	
                if (keyboard.pressed("a")) {
                    player1.position.x -= 0.2* difficulty;
                }
            	
                if (keyboard.pressed('left')) {
                    player2.position.x -= 0.2 * difficulty;
                }
                if (keyboard.pressed('right')) {
                    player2.position.x += 0.2 * difficulty;
                }
                
            }
    firstBB.position = player1.position;
    secondBB.position = player2.position;
	
            if (keyboard.pressed('space') && startedGame == false) {
                startedGame = true;
                startGame = true
                text2.innerHTML = "";
                text3.innerHTML = "";
				text4.innerHTML = "";
				text5.innerHTML = "";
            }
            if (startGame == true) {
                if (p1Lose == true) {
                    ball.position.x -= .2;
                }
                if (p2Lose == true) {
                    ball.position.x += .2;
                }
                if (firstStart == true) {
                    if (temp > 0.5) {
                        ball.position.x += .2;
                    }
                    if (temp < 0.5) {
                        ball.position.x -= .2;
                    }
                }
            }
            if (keyboard.pressed('0')) {
                ballSpeed = 1.5;
            }
            if (topCollisionP1) {
                player1.position.y -= .2 * difficulty;
            }
            if (topCollisionP2) {
                player2.position.y -= .2 * difficulty;
            }
            if (bottomCollisionP1) {
                player1.position.y += .2 * difficulty;
            }
            if (bottomCollisionP2) {
                player2.position.y += .2 * difficulty;
            }
            if (ballCollisionP1) { //if the ball hit player 1
                checkP1 = true;
                checkP2 = false;
                //startGame = false;
				checkTopCol = false;
                checkBottomCol = false;
                p1Lose = false;
                p2Lose = false;
                firstStart = false;
				ballSpeed+=(.015/ 2);
				ballDirY = Math.random() * difficulty;//random direction each time
            }
			
            if (checkP1 == true) { //while the ball is being hit by player 1
                ball.position.x += ballSpeed * ballDirX * difficulty; //send in positive x direction
				if(checkTopCol == false && checkBottomCol == false){ //if it didn't hit the top
					//checkTopCol = false;
					console.log("Player 1 hit");
					ball.position.y += ballSpeed * ballDirY ; //send in positive y direction
					
				}
            }
            if (ballCollisionP2) { //if the ball hit player 2
                checkP2 = true;
                checkP1 = false;
				checkTopCol = false;
                checkBottomCol = false;
                p1Lose = false;
                p2Lose = false;
                firstStart = false;
				ballSpeed+=(.015/ 2);
				ballDirY = Math.random() *difficulty;//random direction each time
            }
            if (checkP2 == true) { //while the ball is being hit by player 2
                ball.position.x -= ballSpeed * ballDirX *difficulty;
				if(checkBottomCol == false && checkTopCol == false ){
					ball.position.y -= ballSpeed * ballDirY ; //send in positive y direction
					console.log("Player 2 hit");
				}
				
            }
			if(topBallCollision){ //if the ball hit the top
				//ballDirY = Math.random();
				checkTopCol = true;
				checkBottomCol = false;
			}
			if(checkTopCol == true){
				ball.position.y -= ballSpeed * ballDirY *difficulty; //send ball off wall
			}
			
			if(bottomBallCollision){ //if the ball hit the bottom
				//ballDirY = Math.random();
				checkBottomCol = true;
				checkTopCol = false;
			}
			if(checkBottomCol == true){
				ball.position.y += ballSpeed * ballDirY * difficulty; //send ball off wall
			}
            if (leftGoalCollision || ball.position.x < -25) {
				P2Score += 1;
                ball.position.x = 0;
                ball.position.y = 0;
                p1Lose = true;
                startGame = false;
                startedGame = false;
                checkP1 = false;
                checkP2 = false;
                checkTopCol = false;
                checkBottomCol = false;
                player2score.innerHTML = P2Score;
                text2.innerHTML = "Red press Space";
                text2.style.left = (WIDTH / 2.13) + 'px';
                ballSpeed = orginalSpeed;
            }
			
			if(P2Score >= 11){
					if((P2Score-P1Score) >= 2){
						console.log("P2Wins");
						text2.innerHTML = "Blue Wins!";
						text2.style.left = (WIDTH/2.08) + 'px';
						text3.innerHTML = "Press Space to start a new game!";
						if(keyboard.pressed("space")){
							//P1Score = 0;
							//P2Score = 0;
							//player1score.innerHTML = P1Score;
							//player2score.innerHTML = P2Score;
							//text2.innerHTML = "";
							//text3.innerHTML = "";
							location.reload();
						}
						
					}
				}
            if (rightGoalCollision || ball.position.x > 25) {
                
				P1Score += 1;
                ball.position.x = 0;
                ball.position.y = 0;
                p2Lose = true;
                startGame = false;
                startedGame = false;
                checkP1 = false;
                checkP2 = false;
                checkTopCol = false;
                checkBottomCol = false;
                player1score.innerHTML = P1Score;
                text2.innerHTML = "Blue press Space";
                text2.style.left = (WIDTH / 2.13) + 'px';
                ballSpeed = orginalSpeed;
            }
			
			if (P1Score >= 11){
					if((P1Score-P2Score) >= 2){
						console.log("P1Wins");
						text2.innerHTML = "Red Wins!";
						text2.style.left = (WIDTH/2.08) + 'px';
						text3.innerHTML = "Press Space to start a new game!";
						if(keyboard.pressed("space")){
							//P1Score = 0;
							//P2Score = 0;
							//player1score.innerHTML = P1Score;
							//player2score.innerHTML = P2Score;
							//text2.innerHTML = "";
							//text3.innerHTML = "";
							location.reload();
						} 
					}
				}
            if (player1.position.x >= -.5) {
                player1.position.x -= 0.2 * difficulty;
            }
            if (player2.position.x <= .5) {
                player2.position.x += 0.2 * difficulty;
            }
            if (player1.position.x <= (leftGoal.position.x + .5)) {
                player1.position.x += 0.2 * difficulty;
            }
            if (player2.position.x >= (rightGoal.position.x - .5)) {
                player2.position.x -= 0.2 * difficulty;
            }
            if (ballCollisionP1_1) {
                console.log("Test1")
            }
					
				
                if (ballCollisionP1_2) {
                    console.log("Test2")
                }
                if (ballCollisionP1_3) {
                    console.log("Test3")
                }
                if (ballCollisionP1_4) {
                    console.log("Test4")
                }
                if (ballCollisionP1_5) {
                    console.log("Test5")
                }
                if (ballCollisionP1_6) {
                    console.log("Test6")
                }
                if (ballCollisionP1_7) {
                    console.log("Test7")
                }
           
            
	renderer.render(scene, camera);
};
 
animate();		</script>
	</body>
</html>
