<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>PONG</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
	<body>
		<script src="../Common/three.js"></script>
		<script src="../Common/THREEx.KeyboardState.js"></script>
		<script>
var WIDTH = 1920,
	HEIGHT = 875;
 
var FOV = 100,
	ASPECT = WIDTH / HEIGHT,
	NEAR = 0.1,
	FAR = 2000;
 
var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(FOV, ASPECT, NEAR, FAR);
var keyboard = new THREEx.KeyboardState();
camera.position.z = 5;
 
var renderer = new THREE.WebGLRenderer();
renderer.setSize(WIDTH, HEIGHT);
document.body.appendChild(renderer.domElement);
 
var geometry = new THREE.BoxGeometry(.5, 1.75, .5);
var material = new THREE.MeshBasicMaterial({ color: 0xbe2626});
var geometry2 = new THREE.BoxGeometry(.5, 1.75, .5);
var material2 = new THREE.MeshBasicMaterial({ color: 0x2f9acf });
var geometry3 = new THREE.BoxGeometry(25, 1, 1);
var material3 = new THREE.MeshBasicMaterial({ color: 0x932f7b }); 

var player1 = new THREE.Mesh(geometry, material);
var player2 = new THREE.Mesh(geometry2, material2);;
var topBarrier = new THREE.Mesh(geometry3, material3);;
var bottomBarrier = new THREE.Mesh(geometry3, material3);;

scene.add(player1);
scene.add(player2);
scene.add(topBarrier);
scene.add(bottomBarrier);


var geometryBall = new THREE.SphereGeometry(.2, 7, 7);
var material = new THREE.MeshBasicMaterial({ color: 0xcacccd });
var ball = new THREE.Mesh(geometryBall, material);
scene.add(ball);


player1.position.x = -10;
player2.position.x = 10;
topBarrier.position.y = 6;
bottomBarrier.position.y = -6;

            var checkP1 = false;
            var checkP2 = false;
			var checkTopCol = false;
			var checkBottomCol = false;
            var startGame = false;
            var startedGame = false;
            var ballSpeed = .1;
            var ballDirX = 1
			var ballDirY = 1;
			
			var difficulty = 1;
var animate = function() {
    requestAnimationFrame(animate);

    firstBB = new THREE.Box3().setFromObject(player1);
    secondBB = new THREE.Box3().setFromObject(player2);
    topCol = new THREE.Box3().setFromObject(topBarrier);
    bottomCol = new THREE.Box3().setFromObject(bottomBarrier);
    ballCol = new THREE.Box3().setFromObject(ball);

    

            var collision = firstBB.intersectsBox(secondBB);
            var topCollisionP1 = firstBB.intersectsBox(topCol);
            var topCollisionP2 = secondBB.intersectsBox(topCol);
            var bottomCollisionP1 = firstBB.intersectsBox(bottomCol);
            var bottomCollisionP2 = secondBB.intersectsBox(bottomCol);
            var ballCollisionP1 = firstBB.intersectsBox(ballCol);
            var ballCollisionP2 = secondBB.intersectsBox(ballCol);
            var topBallCollision = ballCol.intersectsBox(topCol);
			var bottomBallCollision = ballCol.intersectsBox(bottomCol);


			if(keyboard.pressed("r")){
			ball.position.x = 0;
			ball.position.y = 0;
			ballSpeed = .15;
			}
			if(keyboard.pressed("h")){ // add difficulty
				difficulty +=.05;
			}
			
            if (keyboard.pressed("w")) {
                player1.position.y += 0.2 * difficulty;
            }

            if (keyboard.pressed("s")) {
                player1.position.y -= 0.2* difficulty;
            }

            if (keyboard.pressed('down')) {
                player2.position.y -= 0.2 * difficulty;
            }

            if (keyboard.pressed('up')) {
                player2.position.y += 0.2 * difficulty;
            }
    firstBB.position = player1.position;
    secondBB.position = player2.position;
	
            if (keyboard.pressed('space') && startedGame == false) {
                startedGame = true;
                startGame = true
            }

            if (startGame == true) {
                ball.position.x -= .2;
            }

            if (keyboard.pressed('0')) {
                ballSpeed = 1.5;
            }

            if (topCollisionP1) {
                player1.position.y -= .2 * difficulty;
            }
            if (topCollisionP2) {
                player2.position.y -= .2 * difficulty;
            }
            if (bottomCollisionP1) {
                player1.position.y += .2 * difficulty;
            }
            if (bottomCollisionP2) {
                player2.position.y += .2 * difficulty;
            }



            if (ballCollisionP1) { //if the ball hit player 1
                checkP1 = true;
                checkP2 = false;
                startGame = false;
				checkTopCol = false;
				checkBottomCol = false;
				ballSpeed+=.015;
				ballDirY = Math.random() * difficulty;//random direction each time
            }
			
            if (checkP1 == true) { //while the ball is being hit by player 1
                ball.position.x += ballSpeed * ballDirX * difficulty; //send in positive x direction
				if(checkTopCol == false && checkBottomCol == false){ //if it didn't hit the top
					//checkTopCol = false;
					console.log("Player 1 hit");
					ball.position.y += ballSpeed * ballDirY ; //send in positive y direction
					
				}
            }

            if (ballCollisionP2) { //if the ball hit player 2
                checkP2 = true;
                checkP1 = false;
				checkTopCol = false;
				checkBottomCol = false;
				ballDirY = Math.random() *difficulty;//random direction each time
            }

            if (checkP2 == true) { //while the ball is being hit by player 2
                ball.position.x -= ballSpeed * ballDirX *difficulty;
				if(checkBottomCol == false && checkTopCol == false ){
					ball.position.y -= ballSpeed * ballDirY ; //send in positive y direction
					console.log("Player 2 hit");

				}
				
            }

			if(topBallCollision){ //if the ball hit the top
				//ballDirY = Math.random();
				checkTopCol = true;
				checkBottomCol = false;
			}
			if(checkTopCol == true){
				ball.position.y -= ballSpeed * ballDirY *difficulty; //send ball off wall
			}
			
			if(bottomBallCollision){ //if the ball hit the bottom
				//ballDirY = Math.random();
				checkBottomCol = true;
				checkTopCol = false;

			}
			if(checkBottomCol == true){
				ball.position.y += ballSpeed * ballDirY * difficulty; //send ball off wall
			}
			
	renderer.render(scene, camera);
};
 
animate();		</script>
	</body>
</html>

